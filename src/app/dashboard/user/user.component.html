<div *ngIf="users && users.length > 0" [ngClass]="{'blur-background': showModal || showDeleteModal || showUpdateModal}">
  <div class="header-container">
  <h2>Users Management</h2>
  <div *ngIf="isSuperAdmin()" class="button-container">
    <button mat-raised-button class="green-button" (click)="openAddUserModal()">Add User</button>
  </div>
</div>
  <mat-table [dataSource]="users">
    <ng-container matColumnDef="id">
      <mat-header-cell *matHeaderCellDef> Id </mat-header-cell>
      <mat-cell *matCellDef="let user"> {{ user.id || 'Unknown Id' }} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="email">
      <mat-header-cell *matHeaderCellDef> Email </mat-header-cell>
      <mat-cell *matCellDef="let user"> {{ user.email }} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="role">
      <mat-header-cell *matHeaderCellDef> Role </mat-header-cell>
      <mat-cell *matCellDef="let user"> {{ user.role || 'Unknown Role' }} </mat-cell>
    </ng-container>

    <ng-container *ngIf="isSuperAdmin()" matColumnDef="actions">
      <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
      <mat-cell *matCellDef="let user">
        <button mat-flat-button (click)="openUpdateUserModal(user)">Edit</button>
        <button mat-flat-button color="warn" (click)="openDeleteModal(user.id)">Delete</button>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="getDisplayedColumns()"></mat-header-row>
    
    <mat-row *matRowDef="let row; columns: getDisplayedColumns();"></mat-row>
  </mat-table>
</div>

<ng-toast [width]="300" [position]="ToasterPosition.BOTTOM_RIGHT" />

<!-- Add User Modal -->
<div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': showModal}" [ngStyle]="{'display': showModal ? 'block' : 'none'}">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add User</h5>
        <button type="button" class="close" (click)="closeAddUserModal()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addUser()">
          <div class="form-group">
            <label for="add-user-email-id">Email</label>
            <input type="email" class="form-control" [(ngModel)]="newUser.email" name="email-input" required>
          </div>
          <div class="form-group">
            <label for="add-user-password-id">Password</label>
            <input type="password" class="form-control" [(ngModel)]="newUser.password" name="password-input" required>
          </div>
          <div class="form-group">
            <label for="add-user-role-id">Role</label>
            <select class="form-control" [(ngModel)]="newUser.role" name="role-input" required>
              <option value="ADMIN">Admin</option>
              <option value="SUPERADMIN">Superadmin</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Add User</button>
            <button type="button" class="btn btn-secondary" (click)="closeAddUserModal()">Close</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Delete User Modal -->
<div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': showDeleteModal}" [ngStyle]="{'display': showDeleteModal ? 'block' : 'none'}">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete User</h5>
        <button type="button" class="close" (click)="closeDeleteModal()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this user?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Update User Modal -->
<div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': showUpdateModal}" [ngStyle]="{'display': showUpdateModal ? 'block' : 'none'}">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update User</h5>
        <button type="button" class="close" (click)="closeUpdateUserModal()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateUserInfo()"> 
          <div class="form-group">
            <label for="update-user-email-id">Email</label>
            <input type="email" class="form-control" [(ngModel)]="updateUserDetails.email" name="email-input" required>
          </div>
          <div class="form-group">
            <label for="update-user-password-id">Password</label>
            <input type="password" class="form-control" [(ngModel)]="updateUserDetails.password" name="password-input">
          </div>
          <div class="form-group">
            <label for="update-user-role-id">Role</label>
            <select class="form-control" [(ngModel)]="updateUserDetails.role" name="role-input" required> 
              <option value="ADMIN">Admin</option>
              <option value="SUPERADMIN">Superadmin</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Update User</button>
            <button type="button" class="btn btn-secondary" (click)="closeUpdateUserModal()">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

